<!-- 发布页面 -->
<view class="container">
  <!-- 板块选择 -->
  <view class="category-select">
    <view class="section-title">选择板块</view>
    <view class="category-list">
      <view 
        class="category-item {{selectedCategory.code === item.code ? 'active' : ''}}" 
        wx:for="{{categories}}" 
        wx:key="id"
        bindtap="selectCategory"
        data-category="{{item}}"
      >
        <view class="category-icon" style="background-color: {{item.color}}">
          <text class="iconfont {{item.icon}}"></text>
        </view>
        <text class="category-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- 发布表单 -->
  <view class="publish-form">
    <view class="form-item">
      <view class="form-label">标题</view>
      <input 
        class="form-input" 
        placeholder="请输入标题" 
        value="{{form.title}}"
        bindinput="onTitleInput"
        maxlength="100"
      />
      <view class="form-counter">{{form.title.length}}/100</view>
    </view>

    <view class="form-item">
      <view class="form-label">详细描述</view>
      <textarea 
        class="form-textarea" 
        placeholder="请详细描述您的信息" 
        value="{{form.content}}"
        bindinput="onContentInput"
        maxlength="{{selectedCategory.settings.maxContentLength || 2000}}"
      />
      <view class="form-counter">{{form.content.length}}/{{selectedCategory.settings.maxContentLength || 2000}}</view>
    </view>

    <!-- 图片上传 -->
    <view class="form-item">
      <view class="form-label">图片 ({{form.images.length}}/{{selectedCategory.settings.maxImages || 9}})</view>
      <view class="image-upload">
        <view 
          class="image-item" 
          wx:for="{{form.images}}" 
          wx:key="*this"
        >
          <image src="{{item}}" mode="aspectFill" />
          <view class="image-delete" bindtap="deleteImage" data-index="{{index}}">
            <icon type="clear" size="16" color="#fff"></icon>
          </view>
        </view>
        <view 
          class="upload-btn" 
          bindtap="chooseImage" 
          wx:if="{{form.images.length < (selectedCategory.settings.maxImages || 9)}}"
        >
          <icon type="plus" size="32" color="#999"></icon>
          <text>添加图片</text>
        </view>
      </view>
    </view>

    <!-- 价格信息 -->
    <view class="form-item" wx:if="{{selectedCategory.code === 'secondhand' || selectedCategory.code === 'rental'}}">
      <view class="form-label">价格</view>
      <view class="price-input">
        <input 
          class="price-field" 
          type="number" 
          placeholder="请输入价格" 
          value="{{form.price.amount}}"
          bindinput="onPriceInput"
        />
        <text class="price-unit">元</text>
        <view class="negotiable">
          <checkbox value="negotiable" checked="{{form.price.isNegotiable}}" bindchange="onNegotiableChange" />
          <text>价格可议</text>
        </view>
      </view>
    </view>

    <!-- 位置信息 -->
    <view class="form-item">
      <view class="form-label">位置信息</view>
      <view class="location-select" bindtap="chooseLocation">
        <view class="location-info">
          <icon type="location" size="16"></icon>
          <text>{{form.location.address || '点击选择位置'}}</text>
        </view>
        <icon type="arrow" size="16"></icon>
      </view>
    </view>

    <!-- 联系方式 -->
    <view class="form-item">
      <view class="form-label">联系方式</view>
      <view class="contact-inputs">
        <input 
          class="contact-input" 
          placeholder="手机号码" 
          value="{{form.contact.phone}}"
          bindinput="onPhoneInput"
        />
        <input 
          class="contact-input" 
          placeholder="微信号（选填）" 
          value="{{form.contact.wechat}}"
          bindinput="onWechatInput"
        />
      </view>
    </view>

    <!-- 标签 -->
    <view class="form-item">
      <view class="form-label">标签</view>
      <view class="tag-input">
        <view 
          class="tag-item" 
          wx:for="{{form.tags}}" 
          wx:key="*this"
        >
          <text>{{item}}</text>
          <icon type="clear" size="12" bindtap="deleteTag" data-index="{{index}}"></icon>
        </view>
        <input 
          class="tag-field" 
          placeholder="添加标签" 
          value="{{tagInput}}"
          bindinput="onTagInput"
          bindconfirm="addTag"
        />
      </view>
    </view>
  </view>

  <!-- 发布按钮 -->
  <view class="publish-actions">
    <button class="publish-btn" bindtap="publishPost" loading="{{publishing}}">
      发布信息
    </button>
  </view>

  <!-- 广告位 -->
  <view class="ad-section" wx:if="{{adData}}">
    <view class="ad-title">推荐商家</view>
    <view class="ad-content" bindtap="onAdClick" data-ad="{{adData}}">
      <image src="{{adData.image}}" mode="aspectFill" />
      <view class="ad-info">
        <text class="ad-name">{{adData.title}}</text>
        <text class="ad-desc">{{adData.description}}</text>
      </view>
    </view>
  </view>
</view> 